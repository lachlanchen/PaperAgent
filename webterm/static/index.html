<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0f766e" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="/icon.svg" type="image/svg+xml" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css"
    />
    <link rel="stylesheet" href="/static/styles.css" />
    <title>PaperAgent Terminal</title>
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div class="title">PaperAgent Terminal</div>
          <div class="subtitle">Local shell over WebSocket</div>
        </div>
      </div>
      <div class="status-wrap">
        <span id="status" class="status">disconnected</span>
        <button id="reconnect" class="btn">Reconnect</button>
      </div>
    </header>

    <main class="stage">
      <section class="panel control-panel">
        <div class="control-hero">
          <div class="control-badge">Container Only</div>
          <div class="control-title">Project Controls</div>
          <div class="control-subtitle">
            Spin up a paper workspace and jump into it instantly.
          </div>
        </div>

        <div class="field">
          <label for="userInput">Container user</label>
          <input id="userInput" class="input" type="text" value="paperagent" />
        </div>

        <div class="field">
          <label for="projectInput">Project ID</label>
          <input id="projectInput" class="input" type="text" value="demo-paper" />
        </div>

        <div class="field">
          <label for="sshKeyLabel">SSH key label</label>
          <input id="sshKeyLabel" class="input" type="text" value="paperagent@local" />
          <div class="inline-actions">
            <button id="generateSshKey" class="btn ghost">Generate SSH Key</button>
            <button id="setSshConfig" class="btn ghost">Set SSH Config</button>
          </div>
          <div class="helper">Public key</div>
          <textarea
            id="sshKeyOutput"
            class="input ssh-output"
            rows="3"
            readonly
            placeholder="Generate a key to see the public key here."
          ></textarea>
        </div>

        <div class="field">
          <label for="gitRemote">Git remote URL</label>
          <input
            id="gitRemote"
            class="input"
            type="text"
            placeholder="git@github.com:owner/repo.git"
          />
          <div class="inline-actions">
            <button id="setGitRemote" class="btn ghost">Set Git Remote</button>
            <button id="testGitRemote" class="btn ghost">Test GitHub Connection</button>
          </div>
        </div>

        <div id="pathPreview" class="path-preview"></div>
        <div id="projectStatus" class="status-line">Status: unknown</div>

        <div class="control-actions">
          <button id="openProject" class="btn ghost">Go to Project</button>
          <button id="createProject" class="btn primary">Create Project + cd</button>
          <button id="initLatex" class="btn ghost">Init LaTeX</button>
          <button id="compileLatex" class="btn ghost">Compile LaTeX</button>
          <button id="initGit" class="btn ghost">Install Git + Init Repo</button>
          <button id="installCodex" class="btn ghost">Install NVM + Codex</button>
          <button id="installCuda" class="btn ghost">Install CUDA Toolkit</button>
        </div>

        <div class="helper hidden">
          Creates: code, data, figures, latex/latex_figures, artifacts
        </div>
        <div class="helper hidden">Init: latex/main.tex + latex/latex_figures</div>
        <div class="helper hidden">Compile: latexmk in latex/</div>
        <div class="helper hidden">Install: nvm + Node LTS + @openai/codex</div>
        <div class="helper hidden">CUDA: host NVIDIA driver + --gpus all</div>
        <div class="helper code hidden">
          mkdir -p /home/&lt;user&gt;/Projects/&lt;project&gt;/...
        </div>
      </section>

      <section class="panel terminal-panel">
        <div id="terminal" class="terminal"></div>
      </section>

      <section class="panel preview-panel">
        <div class="preview-header">
          <div>
            <div class="preview-title">PDF Preview</div>
            <div class="preview-subtitle">
              MCP loop: plan -> execute -> observe the artifact.
            </div>
          </div>
          <div class="preview-actions">
            <input id="pdfFile" class="input small" type="text" value="main.pdf" />
            <button id="refreshPdf" class="btn ghost">Refresh PDF</button>
            <a id="openPdf" class="btn" href="#" target="_blank" rel="noopener"
              >Open</a
            >
          </div>
        </div>
        <div class="preview-body">
          <div id="pdfEmpty" class="preview-empty">
            No PDF yet. Compile LaTeX to generate one.
          </div>
          <iframe id="pdfFrame" class="preview-frame" title="PDF preview"></iframe>
        </div>
        <div id="pdfStatus" class="preview-status">Status: idle</div>
      </section>
    </main>

    <section class="codex-section">
      <div class="codex-layout">
        <aside class="codex-panel">
          <div class="codex-header">
            <div>
              <div class="codex-title">Codex Bridge</div>
              <div class="codex-subtitle">
                Send prompts to Codex CLI without entering the interactive shell.
              </div>
            </div>
          </div>

          <div class="field">
            <label for="codexSession">Session</label>
            <select id="codexSessionList" class="input codex-select">
              <option value="">Active sessions</option>
            </select>
            <input id="codexSession" class="input" type="text" placeholder="Session id" />
          </div>

          <div class="field">
            <label for="gitUserName">Git user.name</label>
            <input id="gitUserName" class="input" type="text" placeholder="Your Name" />
          </div>

          <div class="field">
            <label for="gitUserEmail">Git user.email</label>
            <input
              id="gitUserEmail"
              class="input"
              type="email"
              placeholder="you@example.com"
            />
            <div class="inline-actions">
              <button id="setGitIdentity" class="btn ghost">Set Git Identity</button>
            </div>
          </div>

          <div class="codex-actions">
            <button id="codexNew" class="btn ghost">New Session</button>
            <button id="codexResume" class="btn ghost">Resume</button>
            <button id="codexStop" class="btn">Stop</button>
            <button id="codexInit" class="btn ghost">Run /init</button>
            <button id="createGitignore" class="btn ghost">Create .gitignore</button>
            <button id="gitCommitPush" class="btn ghost">Status + Add + Commit + Push</button>
          </div>

          <div class="codex-inputs">
            <textarea id="codexPrompt" class="codex-prompt" rows="3"></textarea>
            <button id="codexSend" class="btn primary">Send</button>
          </div>

          <div id="codexStatus" class="codex-status">Status: idle</div>
        </aside>

        <div class="codex-body">
          <div id="codexOutput" class="codex-output"></div>
        </div>
      </div>
    </section>

    <section class="editor-section">
      <div class="editor-header">
        <div>
          <div class="editor-title">Project Editor</div>
          <div class="editor-subtitle">
            Sublime-like editing with live sync to the container.
          </div>
        </div>
        <div class="editor-actions">
          <input
            id="editorPath"
            class="input"
            type="text"
            value="latex/main.tex"
          />
          <button id="loadFile" class="btn ghost">Load</button>
          <button id="saveFile" class="btn primary">Save</button>
          <label class="toggle">
            <input id="watchFile" type="checkbox" checked />
            Watch
          </label>
        </div>
      </div>
      <div class="editor-layout">
        <aside class="file-tree">
          <div class="file-tree-header">
            <div class="file-tree-title">Files</div>
            <button id="refreshTree" class="btn ghost small">Refresh</button>
          </div>
          <div id="fileTree" class="file-tree-body"></div>
          <div id="fileTreeStatus" class="file-tree-status">Status: idle</div>
        </aside>
        <div class="editor-body">
          <textarea id="editorText"></textarea>
        </div>
      </div>
      <div id="editorStatus" class="editor-status">Status: idle</div>
    </section>

    <section class="hint">
      <div class="pill">Scope: Docker shell</div>
      <div class="meta">Run: python server.py --host 0.0.0.0 --port 8766</div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/selection/active-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/stex/stex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/markdown/markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="/static/app.js" defer></script>
  </body>
</html>
